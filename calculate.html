<!--
    genmono tools v2 beta | (c) 2015 | ∑(っ °Д °;)っ 20150125
    author heroboy999 heroboy999@gmail.com
    ##################################################
    ##############################,,;#################
    #############################;,,,;##t#############
    ############################,,,,,,,,;;############
    ############################,,,i,,,,,;;###########
    ###########;;,,;############,,:;j,,,,,,i##########
    ###########;,,,,,,,########i,:j:j::,,,,iit########
    ##########;,,,::::,,#######,,:.......::,,;;#######
    ###########,,,:...::########,,::::...:,,,,;#######
    ################:.################..:j,,,#########
    ################j.################...:,,,#########
    #################i###############:..::,,,#########
    ################################:..####,,#########
    #######;;,,####################.##################
    #######,;:,###########f###########################
    #######,:..##...####L#GDDDD#######################
    #######::.....######DDGfLGDGf#####################
    ###,###..:;########LfLDGLDLfDD###########,,,,#####
    #i;,,##..########fGLDGLfjfDGDGf##########,,,,t####
    #;,,,..,#########GfffftffjffGfD########..:,ii#####
    #;,,,..#########LGGfffjfjffffLDG##################
    #t,jj..#######fffGLLffjtttjffLDGGG################
    ###:...########GfffLLffttttfffLGG############i####
    ###,:..########fftfGGfLjtjtffjfLL######..####;;###
    ##,,,..########jttjLLftjfjffttLLLf#######.:,,,,;##
    #,,,,..#######ftjtLtffjtttfftjLLLf########.,,;,;##
    #####:,#######jtffjfffffffffLLGDLLD########.:ii,;#
    #####:;#######jtffffjffffffLLGGGGGGDL######..,,,;#
    ####,,#######DjtttttfffffLLGGGLLLLL########..,,i##
    ##;,:,########fttttfffffLLGGGGGLffG########..,,;t#
    #i,,:.#########GfLGGffffLGGGGDGLLG#########::,,,;#
    #i,,,.,##.######fD,fGfffLGGGG;Lt##########.,,,,,;#
    ##;,,:.#...#######fLjDLLLGGGjfL########..:,,,;####
    ##i,,,:....#########GGGGGGGG##########:.##########
    ###;,,,....#########################::############
    ####;,,:..########################,::#############
    #####;,,:..####################;,,:.##############
    #######,:..###################i,,:..##############
    ########,::.##################,,.::###############
    ###########::#################::.:################
    ############################..####################
    ###########################:.#####################
    ##################################################
        
-->
<!DOCTYPE html>
<html ng-app>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta content="heroboy999" name="author">
        <title>幻獸物語2 工具箱</title>
        <meta content="website" property="og:type">
        <meta name="keywords" content="幻獸物語2,幻獣物語２">
        <meta content="幻獸物語2 工具箱" property="og:title">
        <meta content="提供簡單小工具" property="og:description">
        <meta content="" property="og:image">
        <meta content="http://shesheshe.github.io/genmono/" property="og:url">
        <meta content="提供簡單小工具" name="description">
        <meta content="幻獸物語2 工具箱" name="twitter:title">
        <meta content="提供簡單小工具" name="twitter:description">
        <meta content="幻獸物語2 工具箱" name="twitter:title">
        <meta content="提供簡單小工具" name="twitter:description">
        <meta content="" name="twitter:image:src">
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/bootstrap-theme.min.css">
        <link rel="stylesheet" href="css/bootstrap-select.min.css">
        <link rel="stylesheet" href="css/jquery-ui.min.css">
        <style type="text/css">
            img.big {
                height: 50px;
                width: 50px;
            }
            img.small {
                height: 40px;
                width: 40px;
            }
            img.xsmall {
                height: 20px;
                width: 20px;
            }
            .table td {
                vertical-align: middle !important;
                text-align: center !important;
            }
        </style>
    </head>
    <body>
        <div id="nav"></div>

        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12">
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <select class="selectpicker" id="evolution">
                        <option value="">請選擇(下位)</option>
                    </select> <font color="#f00" size="4">or</font> 
                    <select class="selectpicker" id="evolution2">
                        <option value="">請選擇(上位)</option>
                    </select>
                    </p>
                    <table class="table table-bordered one">
                    </table>    
                </div>
            </div>
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        status
                    </h3>
                </div>
                <div class="panel-body status"  style="position: relative;">
                    status: none
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <table class="table table-bordered">
                        <tr class="danger">
                            <td width="5%"></td>
                            <td width="5%">固有值</td>
                            <td width="10%">點數</td>
                            <td width="10%">能力</td>
                            <td width="10%">技能修正</td>
                            <td width="60%">調整</td>
                        </tr>
                        <tr>
                            <td width="5%">stamina</td>
                            <td width="5%"><div id="stamina_base"></div></td>
                            <td width="10%"><div id="stamina_base2">1</div></td>
                            <td width="10%"><div id="stamina_base3"></div></td>
                            <td width="10%"><div id="stamina_base4"></div></td>
                            <td width="60%">
                                <!--<div><input id="stamina_event_des" type="button" value="-1"/></div>-->
                                <div id="stamina_event"></div>
                                <!--<div><input id="stamina_event_add" type="button" value="+1"/></div>-->
                            </td>
                        </tr>
                        <tr class="info">
                            <td width="5%">attack</td>
                            <td width="5%"><div id="attack_base"></div></td>
                            <td width="10%"><div id="attack_base2">1</div></td>
                            <td width="10%"><div id="attack_base3"></div></td>
                            <td width="10%"><div id="attack_base4"></div></td>
                            <td width="60%"><div id="attack_event"></div></td>
                        </tr>
                        <tr>
                            <td width="5%">defense</td>
                            <td width="5%"><div id="defense_base"></div></td>
                            <td width="10%"><div id="defense_base2">1</div></td>
                            <td width="10%"><div id="defense_base3"></div></td>
                            <td width="10%"><div id="defense_base4"></div></td>
                            <td width="60%"><div id="defense_event"></div></td>
                        </tr>
                        <tr class="info">
                            <td width="5%">luck</td>
                            <td width="5%"><div id="luck_base"></div></td>
                            <td width="10%"><div id="luck_base2">1</div></td>
                            <td width="10%"><div id="luck_base3"></div></td>
                            <td width="10%"><div id="luck_base4"></div></td>
                            <td width="60%"><div id="luck_event"></div></td>
                        </tr>
                        <tr>
                            <td width="5%"></td>
                            <td width="5%"></td>
                            <td width="10%"><div id="total">0</div></td>
                            <td width="10%"></td>
                            <td width="10%"></td>
                            <td width="60%"></td>
                        </tr>                            
                    </table>
                </div>
                <div class="col-md-12">
                    <table class="table table-bordered">
                        <tr>
                            <td><input type="button" value="單誘惑" attr="single_temptation"/></td>
                            <td><input type="button" value="雙誘惑" attr="double_temptation"/></td>
                            <td><input type="button" value="單惡戲" attr="single_dalliance"/></td>
                            <td><input type="button" value="雙惡戲" attr="double_dalliance"/></td>
                            <td><input type="button" value="取消技能狀態" attr="test"/></td>
                            <td><input type="button" value="---" attr="test"/></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        
        <div id="footer"></div>
        <div id="modal_popup"></div>
        
        <br />
        <br />
        <br />
        <br />
        <br />
        <br />
        <br />
        <br />
        <br />
        <br />
        <script type="text/javascript" src="js/angular.min.js"> </script>
        <script type="text/javascript" src="js/jquery-2.1.3.min.js"> </script>
        <script type="text/javascript" src="js/bootstrap.min.js"> </script>
        <script type="text/javascript" src="js/bootstrap-select.min.js"> </script>
        <script type="text/javascript" src="js/i18n/defaults-zh_TW.min.js"> </script>
        <script type="text/javascript" src="js/jquery-ui.min.js"> </script>
        <script type="text/javascript" src="js/jquery.ui.touch-punch.min.js"> </script>
        <script type="text/javascript">
            
            $(function() {
                console.log("∑(っ °Д °;)っ init monster_info");

                $.ajax({
                    type: 'GET',
                    url: 'monster_data.json',
                    dataType: "json",
                    error: function (xhr) {
                        //console.log("error");
                    },
                    success: function (response) {
                        //console.log("success");
                        var alldata = response;
                        
                        $("#nav").load("nav.html");
                        $("#footer").load("footer.html");
                        $("#modal_popup").load("modal_popup.html");
                        
                        var skill_type = "";

                        var stamina_fn = function( event, ui ) {
                            $("div#stamina_base2").html(ui.value);
                            $("div#stamina_base3").html(Math.round($("div#stamina_base").html() * ui.value));
                            $("div#total").html(parseInt($("div#stamina_base2").html()) + 
                                                parseInt($("div#attack_base2").html()) + 
                                                parseInt($("div#defense_base2").html()) +
                                                parseInt($("div#luck_base2").html()));
                                                    
                            if(skill_type!="") {
                                $("input[attr=" + skill_type + "]").trigger("click");
                            }
                        };
                        
                        $("div#stamina_event").slider({
                            max:999,
                            min:1,
                            value:1,
                            slide:stamina_fn
                        });
                        
                        /* test
                        $("input#stamina_event_des").on("click", function() {
                            $("div#stamina_event").slider({
                                value:($("div#stamina_event").slider("value") - 1),
                                slide:stamina_fn
                            });
                        });
                        
                        $("input#stamina_event_add").on("click", function() {
                            $("div#stamina_event").slider("value",($("div#stamina_event").slider("value") + 1));
                            $("div#stamina_event").trigger("slider");
                        });*/
                        
                        $("div#attack_event").slider({
                            max:999,
                            min:1,
                            slide: function( event, ui ) {
                                $("div#attack_base2").html(ui.value);
                                $("div#attack_base3").html(Math.round($("div#attack_base").html() * ui.value));
                                $("div#total").html(parseInt($("div#stamina_base2").html()) + 
                                                    parseInt($("div#attack_base2").html()) + 
                                                    parseInt($("div#defense_base2").html()) +
                                                    parseInt($("div#luck_base2").html()));
                                                    
                                if(skill_type!="") {
                                    $("input[attr=" + skill_type + "]").trigger("click");
                                }
                            }
                        });
                        $("div#defense_event").slider({
                            max:999,
                            min:1,
                            slide: function( event, ui ) {
                                $("div#defense_base2").html(ui.value);
                                $("div#defense_base3").html(Math.round($("div#defense_base").html() * ui.value));
                                $("div#total").html(parseInt($("div#stamina_base2").html()) + 
                                                    parseInt($("div#attack_base2").html()) + 
                                                    parseInt($("div#defense_base2").html()) +
                                                    parseInt($("div#luck_base2").html()));
                                                    
                                if(skill_type!="") {
                                    $("input[attr=" + skill_type + "]").trigger("click");
                                }                                            
                            }
                        });
                        $("div#luck_event").slider({
                            max:999,
                            min:1,
                            slide: function( event, ui ) {
                                $("div#luck_base2").html(ui.value);
                                $("div#luck_base3").html(Math.round($("div#luck_base").html() * ui.value));
                                $("div#total").html(parseInt($("div#stamina_base2").html()) + 
                                                    parseInt($("div#attack_base2").html()) + 
                                                    parseInt($("div#defense_base2").html()) +
                                                    parseInt($("div#luck_base2").html()));
                                                    
                                if(skill_type!="") {
                                    $("input[attr=" + skill_type + "]").trigger("click");
                                }                                            
                            }
                        });
                        
                        //init
                        get_monster_for_select();

                        //event
                        $("input[attr=single_temptation]").on('click', function() {
                            var s = parseInt($("div#stamina_base3").html()),
                                a = parseInt($("div#attack_base3").html());
                        
                            $("div#stamina_base4").html(parseInt(s - (s * 0.20)));
                            $("div#attack_base4").html(parseInt(a + (s * 0.20)));
                            $("div#defense_base4").html($("div#defense_base3").html());
                            $("div#luck_base4").html($("div#luck_base3").html());

                            show_status("single_temptation");
                        });

                        $("input[attr=double_temptation]").on('click', function() {
                            var s = parseInt($("div#stamina_base3").html()),
                                a = parseInt($("div#attack_base3").html());
                        
                            $("div#stamina_base4").html(parseInt(s - (s * 0.36)));
                            $("div#attack_base4").html(parseInt(a + (s * 0.36)));
                            $("div#defense_base4").html($("div#defense_base3").html());
                            $("div#luck_base4").html($("div#luck_base3").html());

                            show_status("double_temptation");
                        });

                        $("input[attr=single_dalliance]").on('click', function() {
                            var s = parseInt($("div#stamina_base3").html()),
                                a = parseInt($("div#attack_base3").html()),
                                d = parseInt($("div#defense_base3").html());
                        
                            $("div#stamina_base4").html(parseInt(s + (d * 0.20)));
                            $("div#attack_base4").html(parseInt(a + (d * 0.20)));
                            $("div#defense_base4").html(parseInt(d - (d * 0.20)));
                            $("div#luck_base4").html($("div#luck_base3").html());

                            show_status("single_dalliance");
                        });

                        $("input[attr=double_dalliance]").on('click', function() {
                            var s = parseInt($("div#stamina_base3").html()),
                                a = parseInt($("div#attack_base3").html()),
                                d = parseInt($("div#defense_base3").html());
                                
                            $("div#stamina_base4").html(parseInt(s + (d * 0.36)));
                            $("div#attack_base4").html(parseInt(a + (d * 0.36)));
                            $("div#defense_base4").html(parseInt(d - (d * 0.36)));
                            $("div#luck_base4").html($("div#luck_base3").html());
                            
                            show_status("double_dalliance");
                        });

                        $("input[attr=test]").on('click', function() {
                            show_status("");
                        });
                        
                        $("select#evolution,#evolution2").change(function() {
                            var data = monster_data(), row = data.list.length, _no = $(this).val(), temp = {"list":[]};

                            for (var i = 0; i < row; i++) {
                                if(data.list[i].no == _no) {
                                    temp.list[0] = data.list[i];
                                }
                            }

                            $("div#stamina_base").html(temp.list[0].S);
                            $("div#attack_base").html(temp.list[0].A);
                            $("div#defense_base").html(temp.list[0].D);
                            $("div#luck_base").html(temp.list[0].L);

                            $("div#stamina_base3").html(Math.round($("div#stamina_base2").html() * temp.list[0].S));
                            $("div#attack_base3").html(Math.round($("div#attack_base2").html() * temp.list[0].A));
                            $("div#defense_base3").html(Math.round($("div#defense_base2").html() * temp.list[0].D));
                            $("div#luck_base3").html(Math.round($("div#luck_base2").html() * temp.list[0].L));
                            
                            $("div#total").html(parseInt($("div#stamina_base2").html()) + 
                                                parseInt($("div#attack_base2").html()) + 
                                                parseInt($("div#defense_base2").html()) +
                                                parseInt($("div#luck_base2").html()));
                            
                            $("table.one").html("");
                            show_class_list(temp);
                        });
                        
                        //function
                        function show_status(status) {
                            var show = "";
                            skill_type = status;
                            switch(status) {
                                case "single_temptation":
                                    show = "單誘惑";
                                    break;
                                case "double_temptation":
                                    show = "雙誘惑";
                                    break;
                                case "single_dalliance":
                                    show = "單惡戲";
                                    break;
                                case "double_dalliance":
                                    show = "雙惡戲";
                                    break;
                                case "":
                                default:
                                    show = "無";
                                    break;                    
                            };
                            $("div.status").html("status: " + show);
                        }
                        
                        function show_class_list(data) {
                            var row = data.list.length, col = 0, img = "", img2 = "", img3 = "";
                            var TableData = "<tr class='danger'><td>名稱</td><td>圖片</td><td>類別</td><td>屬性</td><td>進化前</td><td>進化道具</td><td>體力</td><td>攻擊</td><td>防禦</td><td>幸運</td></tr>";

                            for (var i = 0; i < row; i++) {
                                if((i+1)%2 != 0) {
                                    TableData += "<tr>";
                                } else {
                                    TableData += "<tr class=\"info\">";
                                }

                                if(is_limit(data.list[i].img.substring(0, 4))) {
                                    img = "?";
                                } else {
                                    img = create_img(safe_img(data.list[i].img), "big", 0);
                                }                        
                                
                                iName = data.list[i].use[0];
                                if(is_limit(iName)) {
                                    img3 = "?<br />" + iName;
                                } else {
                                    img3 = create_img(safe_img(iName), "big", 1) + "<br />" + iName;
                                }

                                switch(data.list[i].no) {
                                    case "1":
                                        img2 = "任一幻獸等級到達LV100以上, 即可使用.";
                                        break;
                                    case "2":
                                        img2 = "任一幻獸等級到達LV10以上, 即可使用.";
                                        break;
                                    case "139":
                                        img2 = "任一幻獸等級到達LV10以上, 即可使用. (低機率出現)";
                                        break;
                                    default:
                                        img2 = get_img(data.list[i].previous, false);
                                        break;
                                }

                                TableData += "<td width='200px'>" + data.list[i].name + "</td>";
                                TableData += "<td>" + img + "</td>";
                                TableData += "<td>" + data.list[i].class + "</td>";
                                TableData += "<td>" + data.list[i].kind + "</td>";
                                TableData += "<td>" + img2 + "</td>";
                                TableData += "<td>" + img3 + "</td>";
                                TableData += "<td>" + data.list[i].S + "</td>";
                                TableData += "<td>" + data.list[i].A + "</td>";
                                TableData += "<td>" + data.list[i].D + "</td>";
                                TableData += "<td>" + data.list[i].L + "</td>";
                                TableData += "</tr>";
                            }
                            $("table.one").append(TableData);                
                        }

                        function get_img(_no, _use) {
                            var _return = "", html = "";
                            if(typeof _use == 'undefined') {
                                _use = true;
                            }
                            if(typeof _no !== 'string') {
                                col_tmp = parseInt(12 / _no.length); 
                                html += '<div class="container-fluid">';
                                html += '<div class="row">';
                                
                                for(var i=0; i<_no.length; i++) {
                                html += '<div class="col-md-' + col_tmp + '">';
                                    html += get_img2(_no[i], _use);
                                    html += '</div>';
                                }
                                
                                html += '</div>';
                                html += '</div>';
                                _return = html;
                            } else {
                                _return = get_img2(_no, _use);
                            }
                            return _return;
                        }
                        
                        //顯示幻獸以及他的變化
                        function get_img2(_no, _use) {
                            var data = monster_data(), iName = "";
                            
                            for(var i in data.list) {
                                if(data.list[i].no == _no) {
                                    iName = data.list[i].use[0];
                                    if(is_limit(data.list[i].img.substring(0, 4))) {
                                        img = "?<br />" + data.list[i].name;
                                    } else {
                                        img = create_img(safe_img(data.list[i].img), "small", 0) + "<br />" + data.list[i].name;
                                    }
                                    
                                    if(is_limit(iName)) {
                                        img2 = "?<br />" + iName;
                                    } else {
                                        img2 = create_img(safe_img(iName), "xsmall", 1) + "<br />" + iName;
                                    }

                                    html = '<div class="container-fluid">';
                                    html += '  <div class="row">';
                                    html += '    <div class="col-md-12">';
                                    html += img;
                                    html += '    </div>';
                                    html += '  </div>';
                                    
                                    if(_use) {
                                        html += '  <div class="row">';
                                        html += '    <div class="col-md-12">';
                                        html += img2;
                                        html += "    </div>";
                                        html += "  </div>";
                                    }
                                    
                                    if(data.list[i].ps !== undefined) {
                                        html += "<div><font color='#f00' size='1'>" + data.list[i].ps + "</font></div>";
                                    }
                                    html += "</div>";
                                    return html;
                                }
                            }
                            return "";                
                        }
                        
                        function get_monster_for_select() {
                            var data = monster_data(), row = data.list.length, option = "";
                            
                            for(var i=2; i<row; i++) {
                                switch(data.list[i].class) {
                                    case "F":
                                    case "E":
                                    case "D":
                                    case "C":
                                    case "B":
                                        option += "<option value='" + data.list[i].no+"'>" + 
                                                  data.list[i].class + ". " + data.list[i].name + " (" + data.list[i].use[0] + ")" +
                                                  "</option>";
                                }
                            }
                            $("select#evolution").append(option);
                            option = "";
                            for(var j=2; j<row; j++) {
                                switch(data.list[j].class) {
                                    case "A":
                                    case "S":
                                    case "SS":
                                    case "SS+":
                                        option += "<option value='" + data.list[j].no+"'>" + 
                                                  data.list[j].class + ". " + data.list[j].name + " (" + data.list[j].use[0] + ")" + 
                                                  "</option>";
                                    }
                            }
                            $("select#evolution2").append(option);    
                        }
                        
                        function safe_img(img_name) {
                            var new_img_name = img_name + '.png';
                            switch(img_name) {
                                case "叛逆のスープ":
                                    new_img_name = "湯.png";
                                    break;
                                case "魂の蓄壷":
                                    new_img_name = "魂の蓄壷.jpeg";
                                    break;
                            }
                            
                            return new_img_name;
                        }
                        
                        function is_limit(target) {
                            var limit_list = limit_data(), limit = false;
                            if(jQuery.inArray(target, limit_list) != -1) {
                                limit = true;
                            }
                            return limit;
                        }
                        
                        function create_img(src, _class, type) {
                            var img_example = ["<img class='{_class}' src='img/monster/{src}' alt='' />",
                                               "<img class='{_class}' src='img/item3/{src}' alt='' />"];
                            return img_example[type].replace(/{_class}/, _class).replace(/{src}/, src);    
                        }
                        
                        //data
                        function limit_data() {
                            return ["0111","0137","0139","0140","0141","0142","0143","0144","0145","0146","金色的鱗粉","華的蜜","世界樹的葉","鬼燈的實","精靈的微笑","禁じられた猛毒","破壊王の魂","合成獣の石板", "異種族の石板","量産型増強剤","?","転生の鍵","幻獣の繭"];
                        }
                        function monster_data() {
                            return alldata;
                        }  
                    },
                    xhrFields: {
                        onprogress: function (event) {
                            /*if (event.lengthComputable) {
                                now = (event.loaded / event.total).toFixed(2);
                                now = Math.floor(now * 100);
                                //console.log(event.loaded + " / " + event.total);
                                $("div.progress-bar")
                                .attr("aria-valuemax", 100)
                                .css("width", now + "%");
                                
                                $("span.text").html(now + " / 100");

                                if(event.loaded  == event.total) {
                                    $("span.text").html("Loading Done!");
                                }
                            }*/
                        }
                    },
                    complete: function(){
                        //$("div#bar").fadeOut(3000);
                    }
                });
            });
        </script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-50817771-2', 'auto');
            ga('send', 'pageview');
        </script>
    </body>
</html>